---
title: External ID
description: Understanding the externalId field and its relationship with authentication providers
lastUpdated: '2025-11-22'
---

# External ID

The `externalId` field is a crucial concept in MultiTenantKit that bridges your user management system with external authentication providers.

## What is External ID?

The `externalId` is the unique identifier that your **authentication provider** uses to identify a user. This is different from the `id` field, which is MultiTenantKit's internal user identifier.

```typescript
interface User {
  id: string;           // MultiTenantKit's internal ID (UUID)
  externalId: string;   // Auth provider's user ID
  username: string;
  // ... other fields
}
```

## Why Two IDs?

Having both `id` and `externalId` provides flexibility for different integration scenarios:

### Scenario 1: Integrated Auth (e.g., Supabase)

When using Supabase, the users table is managed by the auth provider itself. The `externalId` column doesn't exist in Supabase's schema, so it's mapped to the `id` column. Similarly, `username` doesn't exist, so it's mapped to the `email` column.

This is how MultiTenantKit internally sees a Supabase user after column mapping:

```typescript
{
  id: '123e4567-e89b-12d3-a456-426614174000',           // From auth.users.id
  externalId: '123e4567-e89b-12d3-a456-426614174000',   // Mapped from id
  username: 'john@example.com'                          // Mapped from email
}
```

**Configuration:**
```typescript
const toolkitOptions = {
  users: {
    database: {
      schema: 'auth',
      table: 'users'
    },
    customFields: {
      columnMapping: {
        externalId: 'id',  // Map externalId to the id column
        username: 'email'
      }
    }
  }
};
```

### Scenario 2: Separate Auth (e.g., Auth0, Clerk)

When your users table is separate from the auth provider:

```typescript
// Your users table
{
  id: 'user_abc123',                    // Your internal ID
  externalId: 'auth0|507f1f77bcf86cd', // Auth0's user ID
  username: 'john@example.com'
}
```

In this case:
- `id` is generated by MultiTenantKit (or your system)
- `externalId` stores the auth provider's user identifier
- They are different values

## How It Works with Endpoints

When a user makes an authenticated request to an endpoint, the JWT token contains the auth provider's user ID. MultiTenantKit automatically:

1. **Extracts** the user ID from the JWT token
2. **Maps** it to `principalExternalId`
3. **Looks up** the user by `externalId` in your database

```typescript
// In the handler (automatic)
const principal = extractFromJWT(token);
// principal.authProviderId = 'auth0|507f1f77bcf86cd'

// Passed to use case
await useCases.users.getUser.execute({
  principalExternalId: principal.authProviderId  // Auto-populated
}, context);

// Use case finds user
const user = await userRepository.findByExternalId('auth0|507f1f77bcf86cd');
```

## Common Auth Provider ID Formats

Different auth providers use different ID formats:

| Provider | ID Format | Example |
|----------|-----------|---------|
| **Supabase** | UUID | `123e4567-e89b-12d3-a456-426614174000` |
| **Auth0** | Prefixed string | `auth0\|507f1f77bcf86cd799439011` |
| **Clerk** | Prefixed string | `user_2abc123def456` |
| **Firebase** | Base64 string | `Xy3kJh9mN2pQ1rS4tU5vW6xY7zA8b` |
| **Custom JWT** | Any format | Depends on your implementation |

## Best Practices

1. **Always use externalId for lookups from endpoints**: When a request comes from an authenticated endpoint, use `externalId` to find the user
2. **Use id for internal references**: When referencing users within your system (e.g., `ownerId` in organizations), use the internal `id`
3. **Index externalId**: Ensure your database has an index on `externalId` for fast lookups
4. **Validate uniqueness**: The `externalId` should be unique per user

## Example: Creating a User

When a user signs up through your auth provider and you need to create their profile:

```typescript
// After user signs up with Auth0
const auth0User = {
  sub: 'auth0|507f1f77bcf86cd799439011',  // Auth0's user ID
  email: 'john@example.com'
};

// Create user in MultiTenantKit
const result = await useCases.users.createUser.execute({
  externalId: auth0User.sub,  // Store Auth0's ID
  username: auth0User.email
}, context);

// Result
{
  id: 'generated-uuid',                    // MultiTenantKit's internal ID
  externalId: 'auth0|507f1f77bcf86cd',    // Auth0's ID
  username: 'john@example.com'
}
```

## See Also

- [Authentication Adapters](/docs/adapters/authentication) - Learn about auth provider integrations
- [User Management Use Cases](/docs/use-cases/user-management) - User operations
- [User Endpoints](/docs/endpoints/user-endpoints) - REST API endpoints
